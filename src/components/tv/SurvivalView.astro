---
/**
 * SurvivalView.astro - Immersive TV display for survival majority game
 * A/B voting columns with vote bars and points for team majority alignment
 * HUD elements handled by TVHud + MoonTimer
 */
import ViewContainer from '../shared/ViewContainer.astro';
---
<ViewContainer id="view-survival">
    <!-- STAGE ONLY - HUD and atmosphere handled by layout -->
    <div class="tv-stage">
        <div class="stage-book stage-book--wide immersive-pane">
            <p class="stage-subtitle">Chapter 6: Wisdom of the Village</p>
            <h1 class="stage-title fairy-title--glow animate-breathe">Parenting Pathways</h1>

            <!-- Question Display -->
            <p id="survival-question" class="stage-question survival-question animate-breathe mt-3">
                Waiting for question...
            </p>

            <!-- Voting Columns -->
            <div class="survival-voting-container">
                <div class="survival-option survival-option-a" id="survival-option-a">
                    <div class="survival-option-label">OPTION A</div>
                    <div class="survival-option-votes" id="survival-votes-a">
                        <!-- Team avatars/counts will be injected here -->
                    </div>
                    <div class="survival-vote-bar-container">
                        <div class="survival-vote-bar survival-vote-bar-a" id="survival-bar-a"></div>
                    </div>
                    <div class="survival-vote-count" id="survival-count-a">0</div>
                </div>
                <div class="survival-vs">VS</div>
                <div class="survival-option survival-option-b" id="survival-option-b">
                    <div class="survival-option-label">OPTION B</div>
                    <div class="survival-option-votes" id="survival-votes-b">
                        <!-- Team avatars/counts will be injected here -->
                    </div>
                    <div class="survival-vote-bar-container">
                        <div class="survival-vote-bar survival-vote-bar-b" id="survival-bar-b"></div>
                    </div>
                    <div class="survival-vote-count" id="survival-count-b">0</div>
                </div>
            </div>

            <!-- Team Status Table -->
            <div class="tv-team-answers ethereal-scroll mt-3">
                <table class="scoreboard survival-scoreboard">
                    <thead>
                        <tr>
                            <th>TEAM</th>
                            <th>RESULT</th>
                            <th>SCORE</th>
                        </tr>
                    </thead>
                    <tbody id="survival-teams">
                        <!-- Team rows injected here -->
                    </tbody>
                </table>
            </div>

            <!-- Points Summary -->
            <p id="survival-remaining" class="stage-narrator survival-remaining mt-3">
                <!-- "3 teams earned +100 points!" -->
            </p>
        </div>
    </div>
</ViewContainer>

<style>
    .survival-question {
        font-size: var(--tv-text-large);
        margin-bottom: 1.5rem;
        text-shadow: var(--glow-text);
        /* Fixed content - don't shrink */
        flex-shrink: 0;
    }

    .survival-voting-container {
        display: flex;
        justify-content: center;
        align-items: stretch;
        gap: 2rem;
        margin: 1rem 0;
        /* Allow voting container to shrink if needed */
        flex-shrink: 1;
        min-height: 0;
    }

    .survival-option {
        flex: 1;
        max-width: 550px;
        min-width: 400px;
        border: 2px solid var(--ice-glow);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(15, 40, 71, 0.6);
        backdrop-filter: blur(8px);
        transition: all 0.3s ease;
    }

    .survival-option-a {
        border-color: var(--ice-glow);
        box-shadow: 0 0 20px rgba(135, 206, 235, 0.3);
    }

    .survival-option-b {
        border-color: var(--fairy-lavender);
        box-shadow: 0 0 20px rgba(184, 197, 232, 0.3);
    }

    .survival-option-label {
        font-size: var(--tv-text-small);
        font-weight: bold;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .survival-option-a .survival-option-label {
        color: var(--ice-glow);
    }

    .survival-option-b .survival-option-label {
        color: var(--fairy-lavender);
    }

    .survival-option-votes {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: flex-start;
        gap: 0.25rem;
        min-height: 40px;
        max-height: 60px;
        width: 100%;
        overflow: hidden;
    }

    .survival-vote-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: bold;
        animation: votePopIn 0.3s ease-out;
    }

    @keyframes votePopIn {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        70% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .survival-vote-bar-container {
        width: 100%;
        height: 16px;
        background: rgba(15, 40, 71, 0.8);
        border-radius: 8px;
        overflow: hidden;
        margin-top: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .survival-vote-bar {
        height: 100%;
        width: 0%;
        border-radius: 10px;
        transition: width 0.8s ease-out;
    }

    .survival-vote-bar-a {
        background: linear-gradient(90deg, var(--ice-glow), var(--ice-bright));
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), 0 0 15px var(--ice-glow);
    }

    .survival-vote-bar-b {
        background: linear-gradient(90deg, var(--fairy-lavender), var(--fairy-mist));
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), 0 0 15px var(--fairy-lavender);
    }

    .survival-vote-count {
        font-size: var(--tv-text-small);
        font-weight: bold;
        margin-top: 0.5rem;
        font-family: var(--font-story);
        color: var(--ice-whisper);
    }

    .survival-vs {
        display: flex;
        align-items: center;
        font-size: var(--tv-text-small);
        font-weight: bold;
        color: var(--ice-soft);
        text-shadow: var(--glow-text);
    }

    /* Majority/Minority result states */
    .survival-option.is-majority {
        border-color: var(--status-complete);
        box-shadow: 0 0 30px rgba(127, 212, 163, 0.6);
        animation: majorityPulse 1s ease-in-out infinite;
    }

    .survival-option-a.is-majority {
        box-shadow: 0 0 30px rgba(135, 206, 235, 0.8);
    }

    .survival-option-b.is-majority {
        box-shadow: 0 0 30px rgba(184, 197, 232, 0.8);
    }

    .survival-option.is-minority {
        opacity: 0.5;
        animation: minorityFade 0.5s ease-out;
    }

    @keyframes majorityPulse {
        0%, 100% {
            filter: brightness(1);
        }
        50% {
            filter: brightness(1.2);
        }
    }

    @keyframes minorityFade {
        0% {
            opacity: 1;
            filter: none;
        }
        100% {
            opacity: 0.7;
            filter: grayscale(50%);
        }
    }

    /* Scoreboard styles */
    .survival-scoreboard tbody tr.awarded {
        animation: awardedRow 0.5s ease-out;
    }

    .survival-scoreboard tbody tr.not-awarded {
        opacity: 0.7;
    }

    @keyframes awardedRow {
        0% {
            background-color: rgba(127, 212, 163, 0.5);
        }
        100% {
            background-color: transparent;
        }
    }

    .survival-scoreboard .status-awarded {
        color: var(--status-complete);
        font-weight: bold;
        text-shadow: 0 0 10px var(--status-complete);
    }

    .survival-scoreboard .status-not-awarded {
        color: var(--ice-soft);
        font-weight: normal;
    }

    /* Remaining counter with blink/glow */
    .survival-remaining {
        font-size: var(--tv-text-body);
        font-weight: bold;
        animation: remainingGlow 2s ease-in-out infinite;
    }

    @keyframes remainingGlow {
        0%, 100% {
            text-shadow: var(--glow-text);
            opacity: 1;
        }
        50% {
            text-shadow: var(--glow-ice-strong);
            opacity: 0.85;
        }
    }

    .survival-remaining.critical {
        color: var(--status-oops);
        animation: criticalBlink 0.5s ease-in-out infinite;
    }

    @keyframes criticalBlink {
        0%, 100% {
            opacity: 1;
            text-shadow: 0 0 20px rgba(242, 139, 130, 0.8);
        }
        50% {
            opacity: 0.6;
            text-shadow: 0 0 40px rgba(242, 139, 130, 0.8);
        }
    }
</style>
