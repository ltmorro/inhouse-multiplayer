{% extends "_layout.html" %}

{% block title %}ADMIN CONSOLE{% endblock %}

{% block content %}
<div class="terminal-container">
    <div class="status-bar">
        <span>ADMINISTRATOR CONSOLE</span>
        <span id="current-state">STATE: LOBBY</span>
    </div>

    <!-- Auth View -->
    <div id="auth-view" class="view active">
        <div class="flex-grow flex-center flex-column">
            <h2 class="glow">AUTHENTICATION REQUIRED</h2>
            <form id="auth-form" class="mt-3" style="width: 100%; max-width: 400px;">
                <input type="password" id="admin-password" class="terminal-input" placeholder="ACCESS CODE" autocomplete="off">
                <button type="submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">AUTHORIZE</button>
            </form>
            <p id="auth-error" class="mt-2" style="color: var(--terminal-red, #ff0000);"></p>
        </div>
    </div>

    <!-- Dashboard View -->
    <div id="dashboard-view" class="view">
        <div style="padding: 1rem;">
            <!-- Spotify Connection -->
            <section class="mt-2" id="spotify-section">
                <h3 class="glow">SPOTIFY</h3>
                <div id="spotify-status" class="mt-1" style="display: flex; align-items: center; gap: 1rem;">
                    <span id="spotify-status-text" style="color: var(--terminal-green-dim);">Checking...</span>
                    <a id="spotify-login-btn" href="/spotify/login" class="terminal-btn hidden" style="padding: 0.3rem 0.8rem;">CONNECT SPOTIFY</a>
                </div>
            </section>

            <!-- Music Controller -->
            <section class="mt-2" id="music-controller-section">
                <h3 class="glow">MUSIC CONTROLLER</h3>
                <p style="color: var(--terminal-green-dim); font-size: 0.85rem; margin-bottom: 0.5rem;">Control background music on TV</p>
                <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                    <button id="music-prev-btn" class="terminal-btn" title="Previous Track" style="padding: 0.4rem 0.8rem; font-size: 1.1rem;">
                        &#9664;&#9664;
                    </button>
                    <button id="music-toggle-btn" class="terminal-btn terminal-btn--primary" title="Play/Pause" style="padding: 0.4rem 1rem; font-size: 1.1rem;">
                        &#9654;&#10073;&#10073;
                    </button>
                    <button id="music-next-btn" class="terminal-btn" title="Next Track" style="padding: 0.4rem 0.8rem; font-size: 1.1rem;">
                        &#9654;&#9654;
                    </button>
                </div>
            </section>

            <!-- Lobby Controls -->
            <section class="mt-2" id="lobby-section">
                <h3 class="glow">LOBBY</h3>
                <div class="mt-1" style="display: flex; gap: 0.5rem; align-items: center;">
                    <button id="toggle-qr-btn" class="terminal-btn">SHOW QR CODE</button>
                    <span id="qr-status" style="color: var(--terminal-green-dim);">QR hidden</span>
                </div>
            </section>

            <!-- State Control -->
            <section class="mt-2">
                <h3 class="glow">STATE CONTROL</h3>
                <div class="button-grid mt-1" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    <button class="state-btn terminal-btn" data-state="LOBBY">LOBBY</button>
                    <button class="state-btn terminal-btn" data-state="MACGYVER">MACGYVER</button>
                    <button class="state-btn terminal-btn" data-state="TRIVIA">TRIVIA</button>
                    <button class="state-btn terminal-btn" data-state="TIMER">TIMER</button>
                    <button class="state-btn terminal-btn" data-state="BUZZER">BUZZER</button>
                    <button class="state-btn terminal-btn" data-state="TIMELINE">TIMELINE</button>
                    <button class="state-btn terminal-btn" data-state="MINESWEEPER">MINESWEEPER</button>
                    <button class="state-btn terminal-btn" data-state="PICTUREGUESS">PICTURE GUESS</button>
                    <button class="state-btn terminal-btn" data-state="VICTORY">VICTORY</button>
                </div>
            </section>

            <!-- Teams -->
            <section class="mt-3">
                <h3 class="glow">TEAMS</h3>
                <ul id="team-list" class="mt-1" style="list-style: none; padding: 0;"></ul>
            </section>

            <!-- Points -->
            <section class="mt-3">
                <h3 class="glow">ADD POINTS</h3>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;" class="mt-1">
                    <select id="point-team" class="terminal-input" style="width: auto;"></select>
                    <input type="number" id="point-amount" class="terminal-input" value="50" style="width: 80px;">
                    <button id="add-points-btn" class="terminal-btn terminal-btn--primary">ADD</button>
                </div>
            </section>

            <!-- Buzzer Control -->
            <section id="buzzer-section" class="mt-3" style="display: none;">
                <h3 class="glow">BUZZER CONTROL</h3>
                <div class="mt-1">
                    <label>Select Track:</label>
                    <select id="audio-track-select" class="terminal-input" style="width: 100%;">
                        <option value="">-- Select a track --</option>
                    </select>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" class="mt-1">
                    <button id="play-audio-btn" class="terminal-btn terminal-btn--primary">PLAY AUDIO</button>
                    <button id="stop-audio-btn" class="terminal-btn">STOP AUDIO</button>
                    <button id="reveal-audio-btn" class="terminal-btn">REVEAL ANSWER</button>
                </div>
                <div id="spotify-warning" class="mt-1 hidden" style="color: var(--terminal-amber); font-size: 0.85rem;">
                    Note: Spotify not connected. Audio will show embed player (manual play required).
                </div>
                <hr style="border-color: var(--terminal-green-dim); margin-top: 1rem;">
                <p class="mt-1">Locked by: <span id="buzzer-locker">---</span></p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" class="mt-1">
                    <button id="buzzer-correct-full" class="terminal-btn" style="background: #004400;">ARTIST+SONG +60</button>
                    <button id="buzzer-correct-song" class="terminal-btn" style="background: #003300;">SONG ONLY +30</button>
                    <button id="buzzer-wrong" class="terminal-btn" style="background: #440000;">WRONG</button>
                </div>
            </section>

            <!-- Trivia Control -->
            <section id="trivia-section" class="mt-3" style="display: none;">
                <h3 class="glow">TRIVIA CONTROL</h3>
                <div class="mt-1">
                    <label>Pre-loaded Questions:</label>
                    <select id="trivia-preset-select" class="terminal-input" style="width: 100%;">
                        <option value="">-- Select a question or type custom --</option>
                    </select>
                </div>
                <div class="mt-1">
                    <label>Question:</label>
                    <textarea id="trivia-question-input" class="terminal-input" rows="2" placeholder="Enter trivia question..."></textarea>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;" class="mt-1">
                    <label>Q#:</label>
                    <input type="number" id="trivia-question-id" class="terminal-input" value="1" style="width: 60px;">
                    <button id="send-trivia-btn" class="terminal-btn terminal-btn--primary">SEND QUESTION</button>
                </div>
                <h4 class="mt-2">ANSWERS RECEIVED:</h4>
                <ul id="answer-list" class="mt-1" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;"></ul>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" class="mt-2">
                    <input type="text" id="correct-answer" class="terminal-input" placeholder="CORRECT ANSWER">
                    <button id="reveal-btn" class="terminal-btn terminal-btn--primary">REVEAL</button>
                </div>
            </section>

            <!-- Timer Control (Tinfoil Round) -->
            <section id="timer-section" class="mt-3" style="display: none;">
                <h3 class="glow">TIMER CONTROL</h3>
                <div class="mt-1">
                    <label>Message:</label>
                    <input type="text" id="timer-message-input" class="terminal-input" value="Create your tin foil hat masterpiece!" style="width: 100%;">
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;" class="mt-1">
                    <label>Duration (seconds):</label>
                    <input type="number" id="timer-duration" class="terminal-input" value="180" style="width: 80px;">
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" class="mt-2">
                    <button id="timer-start-btn" class="terminal-btn terminal-btn--primary">START</button>
                    <button id="timer-pause-btn" class="terminal-btn">PAUSE</button>
                    <button id="timer-resume-btn" class="terminal-btn">RESUME</button>
                    <button id="timer-reset-btn" class="terminal-btn">RESET</button>
                </div>
                <div class="mt-2">
                    <p>Status: <span id="timer-status">STOPPED</span></p>
                    <p>Remaining: <span id="timer-remaining">--:--</span></p>
                </div>
            </section>

            <!-- Timeline Control -->
            <section id="timeline-section" class="mt-3" style="display: none;">
                <h3 class="glow">TIMELINE CONTROL</h3>
                <div class="mt-1">
                    <label>Pre-loaded Puzzles:</label>
                    <select id="timeline-preset-select" class="terminal-input" style="width: 100%;">
                        <option value="">-- Select a puzzle or type custom --</option>
                    </select>
                </div>
                <div class="mt-1">
                    <label>Items (one per line, in CORRECT order):</label>
                    <textarea id="timeline-items-input" class="terminal-input" rows="4" placeholder="First event
Second event
Third event
Fourth event"></textarea>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;" class="mt-1">
                    <label>Puzzle#:</label>
                    <input type="number" id="timeline-puzzle-id" class="terminal-input" value="1" style="width: 60px;">
                    <button id="send-timeline-btn" class="terminal-btn terminal-btn--primary">START PUZZLE</button>
                </div>
                <div class="mt-2">
                    <button id="complete-timeline-btn" class="terminal-btn">COMPLETE & REVEAL</button>
                </div>
                <h4 class="mt-2">SUBMISSIONS:</h4>
                <ul id="timeline-submission-list" class="mt-1" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;"></ul>
            </section>

            <!-- Picture Guess Control -->
            <section id="pictureguess-section" class="mt-3" style="display: none;">
                <h3 class="glow">PICTURE GUESS CONTROL</h3>
                <div class="mt-1">
                    <label>Pre-loaded Pictures:</label>
                    <select id="pictureguess-preset-select" class="terminal-input" style="width: 100%;">
                        <option value="">-- Select a picture or enter custom URL --</option>
                    </select>
                </div>
                <div class="mt-1">
                    <label>Picture URL:</label>
                    <input type="text" id="pictureguess-url-input" class="terminal-input" placeholder="/static/images/picture.jpg or https://...">
                </div>
                <div class="mt-1">
                    <label>Hint (optional):</label>
                    <input type="text" id="pictureguess-hint-input" class="terminal-input" placeholder="A clue for the image...">
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;" class="mt-1">
                    <label>Pic#:</label>
                    <input type="number" id="pictureguess-id" class="terminal-input" value="1" style="width: 60px;">
                    <button id="send-picture-btn" class="terminal-btn terminal-btn--primary">SEND PICTURE</button>
                </div>
                <h4 class="mt-2">GUESSES RECEIVED:</h4>
                <ul id="pictureguess-list" class="mt-1" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto;"></ul>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" class="mt-2">
                    <input type="text" id="pictureguess-correct-answer" class="terminal-input" placeholder="CORRECT ANSWER">
                    <button id="reveal-picture-btn" class="terminal-btn terminal-btn--primary">REVEAL</button>
                </div>
            </section>

            <!-- Reset -->
            <section class="mt-3">
                <button id="reset-btn" class="terminal-btn" style="background: #440000;">RESET GAME</button>
            </section>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
{% endblock %}