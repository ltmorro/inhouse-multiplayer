{% extends "_layout.html" %}

{% block title %}MOBILE TERMINAL{% endblock %}

{% block content %}
<!-- Boot Sequence Overlay (shorter for mobile) -->
<div id="boot-sequence" class="boot-sequence">
    <div class="boot-ascii" id="boot-ascii" style="font-size: 0.5rem;"></div>
    <div id="boot-lines"></div>
    <div class="boot-progress" id="boot-progress" style="display: none;">
        <div class="boot-progress__bar" style="width: 200px;">
            <div class="boot-progress__fill" id="boot-progress-fill"></div>
        </div>
        <span class="boot-progress__text" id="boot-progress-text">0%</span>
    </div>
</div>

<!-- VHS Transition Overlay -->
<div class="vhs-transition" id="vhs-transition"></div>
<div class="static-burst" id="static-burst"></div>

<!-- Timer Critical Overlay (red vignette) -->
<div class="timer-critical-overlay" id="timer-critical-overlay"></div>

<!-- Windows 98 Error Dialog -->
<div class="win98-overlay hidden" id="win98-overlay">
    <div class="win98-dialog" style="min-width: 280px; max-width: 90%;">
        <div class="win98-titlebar">
            <div class="win98-titlebar__text">
                <span id="win98-title">Nap Time Error</span>
            </div>
            <button class="win98-close" onclick="Win98Dialog.hide()">√ó</button>
        </div>
        <div class="win98-content">
            <div class="win98-icon" id="win98-icon">‚ö†Ô∏è</div>
            <div class="win98-message" id="win98-message">
                <strong>An error has occurred.</strong>
                Something went wrong.
            </div>
        </div>
        <div class="win98-buttons">
            <button class="win98-btn" onclick="Win98Dialog.hide()">OK</button>
        </div>
    </div>
</div>

<!-- Blue Screen of Death (for elimination) -->
<div class="bsod-overlay hidden" id="bsod-overlay">
    <div class="bsod-content" style="font-size: 0.9rem;">
        <div class="bsod-header">BABY SHOWER GAME</div>
        <div class="bsod-text" style="font-size: 0.8rem;">
            A fatal exception 0E has occurred at 0028:C0011E36.
            The current session will be terminated.
        </div>
        <div class="bsod-team" id="bsod-team-name" style="font-size: 1.5rem;">ELIMINATED</div>
        <div class="bsod-text" style="font-size: 0.8rem;">
            * Your team has been ELIMINATED.<br>
            * The baby claims another nap.
        </div>
        <div class="bsod-prompt" style="font-size: 0.8rem;">
            Tap to continue_
        </div>
    </div>
</div>

<!-- Status Bar -->
<div class="status-bar">
    <div>
        <span id="connection-indicator" class="status-indicator status-indicator--disconnected"></span>
        <span id="connection-status">DISCONNECTED</span>
    </div>
    <div>
        <span id="team-name-display">---</span>
        <span id="player-name-display" style="color: var(--terminal-green-dim); margin-left: 0.5rem;"></span>
    </div>
</div>

<!-- Registration View -->
<div id="view-register" class="view active">
    <div class="flex-grow flex-center flex-column">
        <div class="ascii-art glow">
 ____  _  _  ____  ____  ____  _  _
/ ___)( \/ )/ ___)(_  _)(  __)( \/ )
\___ \ )  / \___ \  )(   ) _) / \/ \
(____/(__/  (____/ (__) (____)\_)(_/
   ___  _  _  __    __  __ _  ____
  /   \( \( )(  )  (  )(  ( \(  __)
 (  O )  \ \ / (_/\ )( /    / ) _)
  \___/(_)\_)\____/(__)\_)__)(____)
        </div>
        <h2 class="glow mt-3">EMERGENCY ACCESS TERMINAL</h2>
        <p style="color: var(--terminal-amber); font-size: 0.9rem;" class="mt-1">PARENTAL VERIFICATION REQUIRED</p>

        <!-- Tab Buttons -->
        <div class="mt-3" style="display: flex; gap: 1rem; width: 100%; max-width: 400px;">
            <button id="tab-create" class="terminal-btn terminal-btn--primary" style="flex: 1;" onclick="showCreateTab()">
                CREATE TEAM
            </button>
            <button id="tab-join" class="terminal-btn" style="flex: 1;" onclick="showJoinTab()">
                JOIN TEAM
            </button>
        </div>

        <!-- Create Team Form -->
        <form id="create-form" class="mt-3" style="width: 100%; max-width: 400px;">
            <input
                type="text"
                id="create-team-name"
                class="terminal-input"
                placeholder="TEAM NAME"
                maxlength="20"
                autocomplete="off"
                autocapitalize="off"
                required
            >
            <input
                type="text"
                id="create-player-name"
                class="terminal-input mt-2"
                placeholder="YOUR NAME"
                maxlength="20"
                autocomplete="off"
                autocapitalize="off"
                required
            >
            <button type="submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">
                INITIALIZE CONNECTION
            </button>
        </form>

        <!-- Join Team Form (hidden by default) -->
        <form id="join-form" class="mt-3" style="width: 100%; max-width: 400px; display: none;">
            <input
                type="text"
                id="join-code"
                class="terminal-input"
                placeholder="JOIN CODE"
                maxlength="4"
                autocomplete="off"
                autocapitalize="characters"
                style="text-transform: uppercase; letter-spacing: 0.5em; text-align: center; font-size: 1.5rem;"
                required
            >
            <input
                type="text"
                id="join-player-name"
                class="terminal-input mt-2"
                placeholder="YOUR NAME"
                maxlength="20"
                autocomplete="off"
                autocapitalize="off"
                required
            >
            <button type="submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">
                JOIN TEAM
            </button>
        </form>

        <p id="register-error" class="mt-2" style="color: var(--terminal-red); display: none;"></p>
    </div>
</div>

<!-- Team Created View (shows join code) -->
<div id="view-team-created" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h2 class="glow">TEAM CREATED</h2>
        <p class="mt-2">Share this code with your teammates:</p>

        <div id="join-code-display" class="mt-3" style="font-size: 3rem; letter-spacing: 0.3em; font-weight: bold; padding: 1rem 2rem; border: 2px solid var(--terminal-green); background: rgba(0, 255, 65, 0.1);">
            ----
        </div>

        <!-- Avatar Selection -->
        <div class="mt-3" style="width: 100%; max-width: 320px;">
            <p style="color: var(--terminal-amber); font-size: 0.85rem; margin-bottom: 0.5rem;">SELECT TEAM AVATAR:</p>
            <div class="avatar-grid" id="avatar-grid">
                <!-- Avatars populated by client.js -->
            </div>
        </div>

        <p class="mt-2" style="color: var(--terminal-green-dim);">Waiting for teammates...</p>

        <div id="players-list" class="mt-2" style="text-align: left;">
            <!-- Player list will be injected here -->
        </div>

        <button id="start-game-btn" class="terminal-btn terminal-btn--primary mt-3" style="display: none;" onclick="proceedToLobby()">
            PROCEED TO LOBBY
        </button>
    </div>
</div>

<!-- Lobby View -->
<div id="view-lobby" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h1 class="glow-strong">STANDBY</h1>
        <p class="mt-2" style="color: var(--terminal-amber);">MILLENNIUM CLOCK SYNCHRONIZING...</p>
        <p class="mt-1" style="color: var(--terminal-green-dim);">Awaiting emergency broadcast...</p>
        <div class="blink mt-3">_</div>
    </div>
</div>

<!-- MacGyver View (Manual Scoring) -->
<div id="view-macgyver" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h2 class="glow">SUPPLY CHAIN COLLAPSE</h2>
        <p style="color: var(--terminal-amber); font-size: 0.9rem;">MACGYVER PROTOCOL</p>
        <p id="macgyver-message" class="mt-2" style="color: var(--terminal-amber);">THE STORES ARE EMPTY. ADAPT OR PERISH.</p>
        <div class="mt-3">
            <p style="color: var(--terminal-green-dim);">Use salvaged materials to survive.<br>Awaiting host judgment...</p>
        </div>
    </div>
</div>

<!-- Trivia View -->
<div id="view-trivia" class="view">
    <div class="flex-grow flex-column">
        <h2 class="glow text-center">ALL SEARCH ENGINES OFFLINE</h2>
        <p class="text-center" style="color: var(--terminal-amber);">THE INTERNET HAS COLLAPSED</p>
        <p class="text-center" style="color: var(--terminal-green-dim); font-size: 0.85rem;">No lifelines. Just what's in your head.</p>

        <div id="trivia-question" class="mt-3 text-center" style="font-size: 1.3rem;">
            <!-- Question text injected here -->
        </div>

        <form id="trivia-form" class="mt-3">
            <input
                type="text"
                id="trivia-answer"
                class="terminal-input"
                placeholder="ENTER RESPONSE"
                autocomplete="off"
                autocapitalize="off"
            >
            <button type="submit" id="trivia-submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">
                TRANSMIT
            </button>
        </form>

        <p id="trivia-status" class="mt-2 text-center" style="color: var(--terminal-green-dim);"></p>
    </div>
</div>

<!-- Timer View (Tin Foil Hat) -->
<div id="view-timer" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h2 class="glow">MIND CONTROL DETECTED</h2>
        <p style="color: var(--terminal-amber); font-size: 0.9rem;">TIN FOIL HAT PROTOCOL</p>
        <p id="timer-message" class="mt-2" style="color: var(--terminal-amber);">THE SATELLITES ARE WATCHING. SHIELD YOURSELF.</p>

        <div id="timer-display" class="timer-display glow-strong mt-3">
            03:00
        </div>

        <div class="timer-progress mt-2" style="max-width: 400px; width: 100%;">
            <div id="timer-progress-bar" class="timer-progress__bar" style="width: 100%;"></div>
        </div>
    </div>
</div>

<!-- Buzzer View -->
<div id="view-buzzer" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h2 class="glow">BABY TALK DETECTED</h2>
        <p style="color: var(--terminal-amber); font-size: 0.9rem;">AUDIO ARCHIVES DAMAGED</p>
        <p id="buzzer-hint" class="mt-1" style="color: var(--terminal-green-dim);">Signal degrading... identify before total data loss!</p>

        <button id="buzzer-button" class="buzzer-btn buzzer-btn--active mt-3">
            <span id="buzzer-text">EXECUTE</span>
        </button>

        <p id="buzzer-status" class="mt-2"></p>
    </div>
</div>

<!-- Timeline View (Sorting) -->
<div id="view-timeline" class="view">
    <div class="flex-grow flex-column">
        <h2 class="glow text-center">TEMPORAL CORRUPTION</h2>
        <p class="text-center" style="color: var(--terminal-amber);">HISTORICAL RECORDS SCRAMBLED</p>
        <p class="text-center" style="color: var(--terminal-green-dim); font-size: 0.85rem;">Restore the timeline before reality collapses!</p>

        <!-- Waiting state (shown when no timeline data) -->
        <div id="timeline-waiting" class="mt-3 flex-grow flex-center flex-column text-center">
            <p style="color: var(--terminal-green-dim);">Awaiting temporal anomaly data...</p>
            <div class="blink mt-2">_</div>
        </div>

        <!-- Active timeline (hidden when waiting) -->
        <div id="timeline-active" class="hidden">
            <ul id="timeline-list" class="timeline-list mt-3">
                <!-- Items injected dynamically -->
            </ul>

            <button id="timeline-submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">
                SUBMIT SEQUENCE
            </button>

            <p id="timeline-status" class="mt-2 text-center"></p>
        </div>
    </div>
</div>

<!-- Minesweeper View (Elimination) -->
<div id="view-minesweeper" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h2 class="glow">NUCLEAR SILO BREACH</h2>
        <p style="color: var(--terminal-amber); font-size: 0.9rem;">FALSE LAUNCH CODES DETECTED</p>
        <p id="minesweeper-message" class="mt-2">Navigate carefully. One wrong move = SYSTEM FAILURE.</p>

        <div id="minesweeper-status" class="mt-3" style="font-size: 1.5rem;">
            STATUS: <span id="player-alive-status" style="color: var(--terminal-green);">OPERATIONAL</span>
        </div>
    </div>
</div>

<!-- Picture Guess View -->
<div id="view-pictureguess" class="view">
    <div class="flex-grow flex-column">
        <h2 class="glow text-center">VISUAL ARCHIVES CORRUPTED</h2>
        <p class="text-center" style="color: var(--terminal-amber);">FAMILY ALBUM FRAGMENTED</p>
        <p class="text-center" style="color: var(--terminal-green-dim); font-size: 0.85rem;">Identify this artifact from the pre-millennium era.</p>

        <div id="pictureguess-hint" class="mt-2 text-center" style="color: var(--terminal-green-dim); font-size: 0.9rem;">
            <!-- Hint text injected here -->
        </div>

        <form id="pictureguess-form" class="mt-3">
            <input
                type="text"
                id="pictureguess-answer"
                class="terminal-input"
                placeholder="IDENTIFY IMAGE"
                autocomplete="off"
                autocapitalize="off"
            >
            <button type="submit" id="pictureguess-submit" class="terminal-btn terminal-btn--primary mt-2" style="width: 100%;">
                ANALYZE
            </button>
        </form>

        <p id="pictureguess-status" class="mt-2 text-center" style="color: var(--terminal-green-dim);"></p>
    </div>
</div>

<!-- Eliminated View -->
<div id="view-eliminated" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h1 style="color: var(--terminal-red); font-size: 3rem;">NAP TIME</h1>
        <p class="mt-2" style="color: var(--terminal-red);">YOU WOKE THE BABY</p>
        <p class="mt-1" style="color: var(--terminal-red); opacity: 0.7; font-size: 0.9rem;">[ DATA UNRECOVERABLE ]</p>
    </div>
</div>

<!-- Victory View -->
<div id="view-victory" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h1 class="glow-strong" style="font-size: 2.5rem;">CRISIS AVERTED</h1>
        <p style="color: var(--terminal-amber);">CIVILIZATION HAS BEEN SAVED</p>
        <div id="victory-message" class="mt-3">
            <!-- Winner announcement injected here -->
        </div>
        <p class="mt-2" style="color: var(--terminal-green-dim); font-size: 0.9rem;">Welcome to the year 2000. The future is now.</p>
    </div>
</div>

<!-- Kicked View -->
<div id="view-kicked" class="view">
    <div class="flex-grow flex-center flex-column text-center">
        <h1 style="color: var(--terminal-red); font-size: 2rem;">ACCESS REVOKED</h1>
        <p class="mt-2" style="color: var(--terminal-red);">TERMINATED BY SYSTEM ADMINISTRATOR</p>
        <p class="mt-1" style="color: var(--terminal-red); opacity: 0.7; font-size: 0.9rem;">[ SECURITY PROTOCOL ENGAGED ]</p>
    </div>
</div>

<!-- Mock Mode Banner (only shown in mock mode) -->
<div id="mock-mode-banner" class="mock-mode-banner hidden">
    MOCK MODE - NO SERVER CONNECTION
</div>

<!-- Chat Input Bar - Floating above reaction bar -->
<div class="chat-input-bar hidden" id="chat-input-bar">
    <input type="text" id="chat-input" class="chat-input" placeholder="Send a message..." maxlength="100" autocomplete="off">
    <button class="chat-send-btn" id="chat-send-btn" title="Send">
        <span class="chat-send-icon">></span>
    </button>
</div>

<!-- Reaction Bar - Floating at bottom -->
<div class="reaction-bar hidden" id="reaction-bar">
    <button class="reaction-btn" data-reaction="üéâ" title="Celebrate">üéâ</button>
    <button class="reaction-btn" data-reaction="üò±" title="Shocked">üò±</button>
    <button class="reaction-btn" data-reaction="üî•" title="Fire">üî•</button>
    <button class="reaction-btn" data-reaction="üíÄ" title="Dead">üíÄ</button>
    <button class="reaction-btn" data-reaction="üëè" title="Applause">üëè</button>
</div>
{% endblock %}

{% block scripts %}
<!-- SortableJS for Timeline -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<!-- Client JS -->
<script src="{{ url_for('static', filename='js/client.js') }}"></script>
{% endblock %}
